<html>

<head>
	<!-- htmlファイルと同じフォルダにあるjQuery.jsを読み込む -->
	<script type="text/javascript" src="../common/jQuery.js"></script>
	<!-- 文字コードをUTF-8に設定（文字化け防止） -->
	<meta charset="UTF-8">
	<!-- タイトル -->
	<title>電卓</title>

	<style>
    	/* ここにCSSを書く */
		input{
			width: 275px;
		}

		button{
			/* width: 15%;
			height: 15%; */
			width: 50px;
			height: 30px;
		}

		#display{
			text-align: right;
		}
	</style>
</head>

<body>
    <!-- ここに画面に表示する内容を書く -->
	<div id="calculator">
		<table>
			<tr>
				<td>
					<input type="text" id="display" readonly  />
				</td>
			</tr>
			<tr>
				<td>
					<!-- 戻るボタン -->
					<button id="button_back">▷</button>

					<!-- 7ボタン -->
					<button id="button_7">7</button>

					<!-- 8ボタン -->
					<button id="button_8">8</button>

					<!-- 9ボタン -->
					<button id="button_9">9</button>

					<!-- 割り算ボタン -->
					<button id="button_division">÷</button>
				</td>
			</tr>
			<tr>
				<td>
					<!-- クリアボタン -->
					<button id="button_c">C</button>

					<!-- 4ボタン -->
					<button id="button_4">4</button>

					<!-- 5ボタン -->
					<button id="button_5">5</button>

					<!-- 6ボタン -->
					<button id="button_6">6</button>

					<!-- 掛け算ボタン -->
					<button id="button_multiplication">×</button>
				</td>
			</tr>
			<tr>
				<td>
					<!-- オールクリアボタン -->
					<button id="button_ac">AC</button>

					<!-- 1ボタン -->
					<button id="button_1">1</button>

					<!-- 2ボタン -->
					<button id="button_2">2</button>

					<!-- 3ボタン -->
					<button id="button_3">3</button>

					<!-- 引き算ボタン -->
					<button id="button_subtraction">-</button>
				</td>
			</tr>
			<tr>
				<td>
					<!-- 0ボタン -->
					<button id="button_0">0</button>

					<!-- 00ボタン -->
					<button id="button_00">00</button>

					<!-- 小数点ボタン -->
					<button id="button_dot">.</button>

					<!-- 計算ボタン -->
					<button id="button_calculation">=</button>

					<!-- 足し算ボタン -->
					<button id="button_addition">+</button>
				</td>
			</tr>
		</table>
	</div>
	
	
	<script>
	    // ここにJavaScriptを書く

		// 計算モードを保持 ("0":無し, "1":足し算, "2":引き算, "3":掛け算, "4":割り算)
		let mode = "0";
		// 値を保持
		let value = 0;
		// クリアフラグ
		let clearFlg = false;

		// 初期表示
		$("#display").val("0");

		// 0ボタン押下時の処理
		$("#button_0").on("click", function(){
			valueDisplay("0");
		});

		// 00ボタン押下時の処理
		$("#button_00").on("click", function(){
			valueDisplay("00");
		});

		// 小数点ボタン押下時の処理
		$("#button_dot").on("click", function(){
			valueDisplay(".");
		});
		
		// 1ボタン押下時の処理
		$("#button_1").on("click", function(){
			valueDisplay("1");
		});

		// 2ボタン押下時の処理
		$("#button_2").on("click", function(){
			valueDisplay("2");
		});

		// 3ボタン押下時の処理
		$("#button_3").on("click", function(){
			valueDisplay("3");
		});

		// 4ボタン押下時の処理
		$("#button_4").on("click", function(){
			valueDisplay("4");
		});

		// 5ボタン押下時の処理
		$("#button_5").on("click", function(){
			valueDisplay("5");
		});

		// 6ボタン押下時の処理
		$("#button_6").on("click", function(){
			valueDisplay("6");
		});

		// 7ボタン押下時の処理
		$("#button_7").on("click", function(){
			valueDisplay("7");
		});

		// 8ボタン押下時の処理
		$("#button_8").on("click", function(){
			valueDisplay("8");
		});

		// 9ボタン押下時の処理
		$("#button_9").on("click", function(){
			valueDisplay("9");
		});


		// 足し算ボタン押下時の処理
		$("#button_addition").on("click", function(){
			calculation();
			mode = "1";
			clearFlg = true;
		});

		// 引き算ボタン押下時の処理
		$("#button_subtraction").on("click", function(){
			calculation();
			mode = "2";
			clearFlg = true;
		});

		// 掛け算ボタン押下時の処理
		$("#button_multiplication").on("click", function(){
			calculation();
			mode = "3";
			clearFlg = true;
		});

		// 割り算ボタン押下時の処理
		$("#button_division").on("click", function(){
			calculation();
			mode = "4";
			clearFlg = true;
		});

		// 計算ボタン押下時の処理
		$("#button_calculation").on("click", function(){
			calculation();
			clearFlg = true;
		});

		// 戻るボタン押下時の処理
		$("#button_back").on("click", function(){
			// 表示されている値を取得
			let curVal = $("#display").val();
			// 取得した値の文字数を取得
			let len = curVal.length;
			if (len > 1){
				// 文字数が1より大きい場合、末尾の文字を削除する
				curVal = curVal.slice(0, len-1);
				// 画面に値を表示
				$("#display").val(curVal);
			}
			else{
				// 表示されている値が1文字の場合
				$("#display").val("0");
			}
		});

		// クリアボタン押下時の処理
		$("#button_c").on("click", function(){
			$("#display").val("0");
		});

		// オールクリアボタン押下時の処理
		$("#button_ac").on("click", function(){
			$("#display").val("0");
			// 保持している値をリセット
			value = 0;
			mode = "0";
		});

		// 画面表示
		function valueDisplay(str){
			if (clearFlg){
				$("#display").val("0");
				clearFlg = false;
			}

			let curVal = $("#display").val();
			if (curVal != "0"){
				// 表示されている値が"0"以外の場合
				if (str != "." || curVal.indexOf(".") == -1){
					// 入力された値が"."の場合、既に"."が入力されている場合は何もしない
					$("#display").val(curVal + str);
				}
			}
			else {
				// 表示されている値が"0"の場合
				if (str != "0" && str != "00"){
					// 入力された値が"0" または "00"以外の場合
					if (str == "."){
						// 入力された値が"."の場合
						$("#display").val(curVal + str);
					}
					else{
						// 入力された値が"."以外の場合
						$("#display").val(str);
					}
				}
			}
		}

		// 計算処理
		function calculation(){
			switch (mode){
				case "0":
					value = Number($("#display").val());
					break;
				case "1":
					value += Number($("#display").val());
					break;
				case "2":
					value -= Number($("#display").val());
					break;
				case "3":
					value *= Number($("#display").val());
					break;
				case "4":
					value /= Number($("#display").val());
					break;
				default :
					alert("エラーが発生しました。");
			}
			mode = "0";
			// 計算結果を表示
			$("#display").val(value);
		}
	</script>
</body>

</html>