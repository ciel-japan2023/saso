<html>

<head>
	<script type="text/javascript" src="jQuery.js"></script>
	<script defer type="text/javascript" src="layout.js"></script>
	<script defer type="text/javascript" src="shooter.js"></script>
	<script defer type="text/javascript" src="invader.js"></script>
	<link rel="stylesheet" href="styles.css">
	<meta charset="UTF-8">
	<title>ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã‚²ãƒ¼ãƒ </title>
</head>

<body>
	<div>
		<table border="2" id="manual">
			<tr>
				<th colspan="2"><label>How To Play</label></th>
			</tr>
			<tr>
				<th><label>Keybord</label></th>
				<th><label>Action</label></th>
			</tr>
			<tr>
				<td><label>â†</label></td>
				<td><label>Move Left</label></td>
			</tr>
			<tr>
				<td><label>â†’</label></td>
				<td><label>Move Right</label></td>
			</tr>
			<tr>
				<td><label>Space</label></td>
				<td><label>Shot</label></td>
			</tr>
		</table>
	</div>
	<div id="screen">
		<!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
		<div id="top">
			<div class="title"><label>Invaders Game</label></div>
			<div id="start_text"><label>Please Push SPACE KEY</label></div>
		</div>

		<!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
		<div id="game" hidden>
			<div id="shooter"></div>
			<div id="bullet" hidden></div>
		</div>

		<!-- ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ -->
		<div id="game_clear" hidden>
			<div class="title"><label>Game Clear!!</label></div>
			<div class="start_text"><label>Press Enter title</label></div>
		</div>

		<!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ -->
		<div id="game_over" hidden>
			<div class="title"><label>Game Over...</label></div>
			<div id="gameOV" class="title"><label></label></div>
		</div>
	</div>

	<div>
		<table border="2" id="player">
			<tr>
				<th><label>ãŠã¾ãˆ</label></th>
				<td id="p_cnt"><label></label></td>
			</tr>
		</table>
	</div>

	<div id="cautions"><label>â€»ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¯åŠè§’ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</label></div>

	<!-- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›å€¤ã‚’å–å¾—ã™ã‚‹ç”¨ -->
	<input type="text" id="input"/>

	<script>
		// ã‚²ãƒ¼ãƒ ã®çŠ¶æ³ï¼ˆ1:ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢, 2:ã‚²ãƒ¼ãƒ ç”»é¢ï¼‰
		let status = "1";
		$(document).ready(function(){
			// ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®å‡¦ç†
			let flashGlg = false;
			let start = setInterval(function () {
				// ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®å‡¦ç†ï¼ˆ500ãƒŸãƒªç§’ï¼ˆ0.5ç§’ï¼‰æ¯ã«setIntervalå†…ã®å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã™ï¼‰
				if (flashGlg){
					$("#start_text").show();
					flashGlg = false;
				}
				else {
					$("#start_text").hide();
					flashGlg = true;
				}
			}, 500);

			// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã¿ã§æ“ä½œã™ã‚‹
			$("#input").focus();
			$("#input").focusout(function () {
				$("#input").focus();
			});
			
			// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æŠ¼ä¸‹æ™‚ã®å‡¦ç†
			$("#input").keydown(function (e) {
				$("#input").val("");
				if (status == "1"){
					// ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã®å ´åˆ
					if (e.keyCode == "32"){
						// ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æŠ¼ä¸‹æ™‚ã€ã‚²ãƒ¼ãƒ é–‹å§‹
						clearInterval(start);
						status = "2";
						$("#top").hide();
						$("#game").show();
						gameStart();
					}
				}
				else if (status == "2"){
					// ã‚²ãƒ¼ãƒ ç”»é¢ã®å ´åˆ
					if (shooter.flg){
						// è‡ªæ©ŸãŒå¥åœ¨ã®å ´åˆã®ã¿å‡¦ç†
						if (e.keyCode == "32"){
							// ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼æŠ¼ä¸‹æ™‚
							if (!shooter.bulletFlg){
								shooter.bulletX = shooter.x + shooterDotW * 4;
								shooter.bulletY = shooter.y;
								shooter.bulletFlg = true;
								$("#bullet").css({
									"margin-left": shooter.bulletX + "px",
									"margin-top": shooter.bulletY +"px"
								});
								$("#bullet").show();
							}
						}
						if (e.keyCode == "37"){
							// å·¦æ–¹å‘ã‚­ãƒ¼æŠ¼ä¸‹æ™‚
							shooter.x = shooter.x - shooterDotW * 2;
								$("#shooter").css("margin-left", shooter.x + "px");
						}
						if (e.keyCode == "39"){
							// å³æ–¹å‘ã‚­ãƒ¼æŠ¼ä¸‹æ™‚
							shooter.x = shooter.x + shooterDotW * 2;
							$("#shooter").css("margin-left", shooter.x + "px");
						}
						if (e.keyCode == "84"){
							// test
							for (let i=1; i<invaders.length; i++){
								invaders[i]["flg"] = false;
								$("#inv_" + i).hide();
							}
						}
					}
				}
			});
		});

		// ã‚²ãƒ¼ãƒ ç”»é¢ã®å‡¦ç†
		function gameStart(){
			playerCount();
			// ã‚²ãƒ¼ãƒ ã‚¹ãƒ†ãƒƒãƒ—æ•°
			let gameStep = 0;
			let game = setInterval(function () {
				// ã‚²ãƒ¼ãƒ ç”»é¢ã®å‡¦ç†ï¼ˆãƒŸãƒªç§’ï¼ˆç§’ï¼‰æ¯ã«setIntervalå†…ã®å‡¦ç†ã‚’ç¹°ã‚Šè¿”ã™ï¼‰
				gameStep++;
				// ã‚¤ãƒ³ãƒ™ãƒ¼ãƒ€ãƒ¼ã®å‡¦ç†
				if (invaderAct(gameStep)){
					// ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
					gameOver();
				}

				// è‡ªæ©Ÿã®å‡¦ç†
				if (shooterAct()){
					// ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢
					gameClear();
				}
			}, 50);
		}

		// ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ã‚’è¡¨ç¤º
		function gameClear(){
			clearInterval(gameStart);
			$("#game").hide();
			$("#game_clear").show();
			status="3";
		}
		// ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚’è¡¨ç¤º
		function gameOver(){
			clearInterval(gameStart);
			$("#game").hide();
			$("#game_over").show();
			status="3";
		}

		$(document).ready(function(){
    $(document).keypress(function(e){
        if(e.which == 13 && status=="3"){ // Enterã‚­ãƒ¼ã®ã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰ã¯13ã§ã™
			location.reload();// ã“ã“ã«Enterã‚­ãƒ¼ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã—ãŸã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜è¿°ã—ã¾ã™
		}
    });
});

	let gameovertext1=['ã‚ãƒ¼ã‚','ã†ãƒ¼ã‚“ã€é›‘é­š','ã‚ˆã£ã‚',"ã¸ã£ãŸ","ã¯ã...","ãƒã‚¸ï¼Ÿ","ã†ãƒ¼ã‚“ã€ã“ã®ã€‚","ğŸ¤”"];
	let gameovertext2=Math.floor(Math.random()*gameovertext1.length);
	$("#gameOV").text(gameovertext1[gameovertext2]).val();
	</script>
</body>

</html>
